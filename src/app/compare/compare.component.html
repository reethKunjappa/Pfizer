<div class="main-content" *ngIf="projectDetails != undefined">
  <div class="row">
    <div class="col-12 pad-0 text-right">
      <button mat-raised-button routerLink="/view/{{projectId}}" type="submit" class="btn btn-spec">Back</button>
      <button mat-raised-button (click)="acceptRejectDocumentsComments();" type="submit"
        class="btn btn-danger btn-spec">Update Document</button>
    </div>
  </div>

  <div class="row m-0">
    <div class="col-12 px-0">
      <div class="card mb-0">
        <div class="card-header card-header-primary row">
          <div class="col-10">
            <h4 class="card-title">{{projectDetails.project.projectName}}</h4>
            <div class="card-category">
              <span>Country : {{ projectDetails.project.country.name }} | Created By :
                {{ projectDetails.project.createdBy.name }} |
                Created On : {{ projectDetails.project.createdOn | date : 'dd-MMM-yyyy' }}</span>
            </div>
          </div>
          <div class="col-2 text-right">
            <button (click)="downloadCommentedLabelDoc();" mat-raised-button type="button" matTooltip="Commented Label"
              [matTooltipPosition]="'above'" class="btn btn-link btn-lg btn-just-icon">
              <i class="material-icons" style="color:black;">cloud_download</i>
            </button>
            <button mat-mini-fab color="warn" [disabled]="projectDetails.project.conflicts.total < 1"
              [mdePopoverTriggerFor]="appPopover"
              mdePopoverTriggerOn="hover">{{ projectDetails.project.conflicts.total }}</button>
            <mde-popover #appPopover="mdePopover" [mdePopoverOverlapTrigger]="false">
              <mat-card style="max-width: 320px;padding: 5px;">
                <mat-card-content>
                  <table class="table table-borderless table-sm table-light">
                    <tbody>
                      <tr *ngFor="let item of projectDetails.project.conflicts.types">
                        <td>{{ item.label }}</td>
                        <td style="padding:5px;">{{ item.value }}</td>
                        <td>
                          <button mat-raised-button type="button" matTooltip="Accept All" [matTooltipPosition]="'above'"
                            class="btn btn-success btn-link btn-sm py-0 px-1 m-0"
                            [disabled]="item.value < 1"
                            *ngIf="item.key != 'spell' && item.key != 'order' && item.key != 'configRules'"
                            (click)="openConfirmationModal('Accept', item.key, item.label)">
                            <i class="material-icons">done_all</i>
                          </button>
                          <button mat-raised-button type="button" matTooltip="Reject All" [matTooltipPosition]="'above'"
                            class="btn btn-danger btn-link btn-sm py-0 px-1 m-0"
                            [disabled]="item.value < 1"
                            *ngIf="item.key != 'spell' && item.key != 'order' && item.key != 'configRules'"
                            (click)="openConfirmationModal('Reject', item.key, item.label)">
                            <i class="material-icons">close</i>
                          </button>
                        </td>
                      </tr>                      
                    </tbody>
                  </table>
                </mat-card-content>
              </mat-card>
            </mde-popover>
          </div>
        </div>

        <mat-sidenav-container autosize=true class="example-container">
          <mat-sidenav #sidenav position="end" mode="side" style="width:40%;background: transparent;">
            <div class="row mx-0 py-2">
              <div class="col-12 text-right">
                <button mat-raised-button type="button" matTooltip="Close Reference Document" [matTooltipPosition]="'above'"
                  class="btn btn-danger btn-spec  btn-sm py-0 px-1 m-0" (click)="sidenav.close()">
                  <i class="material-icons">cancel</i>
                </button>
              </div>
            </div>
            <div class="row mx-1">
              <div class="card mt-1" style="height: 99vh !important" *ngIf="referenceDocuments">
                <iframe id="showRefDoc" frameborder="0" width="100%;" height="800px;"></iframe>
              </div>
            </div>
          </mat-sidenav>

          <mat-sidenav-content>
            <div id="main">
              <div class="row mx-1 w-100 mt-1">
                <div style="width:65%">
                  <div class="row">
                    <div class="col-4">
                      <!--  <button mat-raised-button type="button" matTooltip="Download"
                        class="btn btn-spec btn-link btn-just-icon"><i class="material-icons">save_alt</i></button>  -->
                    </div>
                    <div class="col-4 text-center">
                      <button (click)="pdfViewer.zoomIn()" mat-raised-button type="button" matTooltip="Zoom In" [matTooltipPosition]="'above'"
                        class="btn btn-spec btn-link btn-just-icon"><i class="material-icons" style="font-size: larger;">zoom_in</i></button>
                      <button (click)="pdfViewer.zoomOut()" mat-raised-button type="button" matTooltip="Zoom Out" [matTooltipPosition]="'above'"
                        class="btn btn-spec btn-link btn-just-icon"><i class="material-icons" style="font-size: larger;">zoom_out</i></button>
                    </div>
                    <div class="col-4 text-right">
                      <button (click)="pdfViewer.prevPage()" mat-raised-button type="button" matTooltip="Prev Page" [matTooltipPosition]="'above'"
                        class="btn btn-spec btn-link btn-just-icon"><i class="material-icons" style="font-size: larger;">navigate_before</i></button>
                      <button (click)="pdfViewer.nextPage()" mat-raised-button type="button" matTooltip="Next Page" [matTooltipPosition]="'above'"
                        class="btn btn-spec btn-link btn-just-icon"><i class="material-icons" style="font-size: larger;">navigate_next</i></button>
                    </div>
                  </div>

                  <div class="card my-2" style="height: 91vh !important">
                    <section id="viewer">
                      <simple-pdf-viewer #pdfViewer [src]="labelDocUrl" (onLoadComplete)="onLoadComplete()"
                        [removePageBorders]=false (onError)="onError($event)" (onProgress)="onProgress($event)"
                        (onSearchStateChange)="onSearchStateDetect($event)"></simple-pdf-viewer>
                    </section>
                  </div>
                </div>

                <!-- COMMENTS SECTION -->
                <div style="width:35%;">
                  <div class="row mx-2 pl-1">
                    <ng-select id="conflictTypeNgSelect" class="w-100 my-0 py-0" autoCapitalize="on" dropdownPosition="bottom"
                      [items]="conflictCriterias" bindValue="value" bindLabel="label"
                      placeholder="Select Conflict Criteria" (ngModelChange)="filterItem($event)"
                      [(ngModel)]="conflictType"></ng-select>
                  </div>
                  <div class="row mx-0 pl-2" style="overflow-x: hidden; overflow-y: auto; max-height: 93vh;">
                    <div *ngFor="let item of filteredItems;let i = index" class=" border-info m-1 mr-2 w-100">
                      <mat-card class="p-2" id="{{ i }}">
                        <mat-card-content class="mb-0">
                          <div class="small"
                            [ngClass]="item.action == 'ACCEPT' ? 'btn-success pl-2 rounded' :  (item.action == 'REJECT' ? 'btn-danger pl-2 rounded' : '' )">
                            {{item.conflict_type}} Conflict</div>
                          <hr style="margin: 0.5rem 0" />
                          <!-- (click)="pdfViewer.search(item.comment_text)" -->
                          <div class="small" (click)="pdfViewer.search(item.comment_id)" style="cursor: pointer;">
                            {{item.comment_text}}</div>
                        </mat-card-content>
                        <mat-card-actions class="text-right">
                          <!-- *ngIf="item.conflict_type != 'GRAMMAR_SPELLING' && item.conflict_type != 'ORDER'" -->
                          <button mat-raised-button type="button" matTooltip="Accept" [matTooltipPosition]="'above'"
                            class="btn btn-success btn-link btn-sm btn-just-icon"
                            [hidden]="showAcceptRejectConditions(item)"
                            (click)="acceptOrRejectComment('Accept',item)">
                            <i class="material-icons">check</i>
                          </button>
                          <button mat-raised-button type="button" matTooltip="Reject" [matTooltipPosition]="'above'"
                            class="btn btn-danger btn-link btn-sm btn-just-icon"
                            [hidden]="showAcceptRejectConditions(item)"
                            (click)="acceptOrRejectComment('Reject',item)">
                            <i class="material-icons">close</i>
                          </button>
                          <button mat-raised-button
                            *ngIf="(item.reference_doc!='' && item.reference_doc!=null && item.reference_doc!=undefined && item.conflict_type != 'Spell and Grammar' && item.conflict_type != 'Configured rules' )"
                            type="button" (click)="sidenav.open();getReferenceDocument(item, i);" [matTooltipPosition]="'above'"
                            matTooltip="Reference Document" class="btn btn-primary btn-link btn-sm btn-just-icon">
                            <i class="material-icons">find_in_page</i></button>
                        </mat-card-actions>
                      </mat-card>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </mat-sidenav-content>
        </mat-sidenav-container>
      </div>
    </div>
  </div>
</div>